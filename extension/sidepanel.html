<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigator</title>
    <link rel="stylesheet" href="sidepanel.css">
</head>

<body>

    <header>
        <div class="logo">üß≠ Navigator <span id="recording-badge" class="hidden">REC</span></div>
        <div class="actions">
            <button id="btn-record" aria-label="Record Action" title="Record my actions" class="record-off">‚óè</button>
            <button id="btn-debug" aria-label="Debug" title="Toggle Context Inspector">üêû</button>
            <button id="btn-settings" aria-label="Settings">‚öôÔ∏è</button>
        </div>
    </header>

    <div id="settings-panel" class="hidden">
        <h3>Configuration</h3>
        <p class="hint">Navigator is now powered by Unified Brain Bridge.</p>

        <div class="setting-item">
            <div class="setting-text">
                <span class="setting-label">Visual Overlays</span>
                <span class="setting-desc">Enable on-page highlighting</span>
            </div>
            <label class="switch">
                <input type="checkbox" id="toggle-overlays" checked>
                <span class="slider round"></span>
            </label>
        </div>

        <button id="btn-save-key">CONNECTED TO PORT 8000 (v2.0.4)</button>

        <div class="settings-row">
            <div>
                <div class="settings-label">Visual Navigation Overlays</div>
                <div class="settings-description">Show heatmaps and highlights when navigating</div>
            </div>
            <div class="toggle-switch active" id="toggle-overlays">
                <div class="toggle-switch-slider"></div>
            </div>
        </div>
    </div>

    <div id="debug-panel" class="hidden">
        <div class="debug-section">
            <h4>Meta <div style="display:flex; gap:4px;"><button class="btn-inspect" id="btn-toggle-heatmap"
                        title="Toggle DOM Heatmap">üî• MAP</button><button class="btn-inspect" id="btn-force-scan">FORCE
                        SCAN</button></div>
            </h4>
            <div class="debug-row"><span class="debug-label">ID:</span> <span class="debug-value" id="dbg-id">-</span>
            </div>
            <div class="debug-row"><span class="debug-label">Tab:</span> <span class="debug-value" id="dbg-tab">-</span>
            </div>
            <div class="debug-row"><span class="debug-label">Size:</span> <span class="debug-value"
                    id="dbg-tokens">0</span></div>
        </div>
        <div class="debug-section">
            <h4>Structure</h4>
            <div id="dbg-structure" class="json-view">Loading...</div>
        </div>
        <div class="debug-section">
            <h4>Map</h4>
            <div id="dbg-interaction" class="json-view">[]</div>
        </div>
    </div>

    <div id="chat-container">
        <div class="message ai">
            Hello! I'm reading the page. Ask me anything.
        </div>
    </div>

    <div id="playback-panel" class="hidden">
        <div class="playback-header">
            <span id="playback-title">Playing Workflow</span>
            <button id="btn-stop-playback">‚úï</button>
        </div>
        <div class="playback-body">
            <div id="step-instruction">Follow the on-screen guide.</div>
            <div class="playback-progress">
                <div id="progress-bar"></div>
            </div>
            <div class="playback-controls">
                <button id="btn-prev-step" disabled>Previous</button>
                <span id="step-count">1 / 5</span>
                <button id="btn-next-step">Next</button>
            </div>
        </div>
    </div>

    <div id="navigation-prompt" class="hidden">
        <div class="prompt-content">
            <p>Would you like to navigate on-screen?</p>
            <div class="prompt-actions">
                <button id="btn-nav-yes" class="btn-primary">Yes, Guide Me</button>
                <button id="btn-nav-no" class="btn-secondary">No, Thanks</button>
            </div>
        </div>
    </div>

    <div id="input-area">
        <div id="context-indicator">Unified Bridge Active</div>
        <div class="input-wrapper">
            <textarea id="user-input" placeholder="Ask about this page..." rows="1"></textarea>
            <button id="btn-send">‚û§</button>
        </div>
    </div>

    <script src="sidepanel.js"></script>
</body>

</html>